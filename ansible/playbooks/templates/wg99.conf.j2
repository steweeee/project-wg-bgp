[Interface]
Address = {{ wg_ip_address }}/24
PrivateKey = {{ private_key }}
ListenPort = {{ wg_listen_port }}
PostUp = sysctl -w net.ipv4.ip_forward=1

{% for host in groups['wg_bgp_group'] %}
{% if host != inventory_hostname %}
[Peer]
PublicKey = {{ hostvars[host]['host_public_key'] }}
Endpoint = {{ hostvars[host]['ansible_host'] }}:{{ wg_listen_port }}
AllowedIPs = {{ hostvars[host]['wg_ip_address'] }}/32
{% endif %}
{% endfor %}